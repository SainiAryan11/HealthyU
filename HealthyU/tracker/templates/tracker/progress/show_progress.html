{% extends "tracker/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'tracker/css/pages/progress/show_progress.css' %}">
{% endblock %}


{% block content %}
<div class="progress-page-container">
  <div class="container my-4">

    <div class="progress-header-card">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
          <h2>ğŸ“Š Your Progress Dashboard</h2>
          <p class="text-muted mb-0">Track your daily, weekly, and monthly performance from saved sessions.</p>
        </div>
        <a href="{% url 'profile' %}" class="back-btn-custom">â† Back to Profile</a>
      </div>
    </div>

    {% if not plan %}
    <div class="alert-custom">
      âš ï¸ You don't have an exercise plan yet. Create a plan to start tracking your progress and achievements!
    </div>
    {% endif %}

    <h3 class="sessions-title">ğŸ“… Recent Sessions (Last 30 Days)</h3>

    {% if records %}
    <div class="mt-3">
      {% for r in records %}
      <a href="{% url 'session_report_by_day' r.date|date:'Y-m-d' %}" class="session-card">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="session-date">{{ r.date|date:"d M Y" }}</div>
            <div class="session-meta">
              ğŸ† {{ r.points_earned }} points
              {% if r.report.progress %}
              â€¢ ğŸ“Š {{ r.report.progress }}% complete
              {% endif %}
            </div>
          </div>
          <span class="session-badge">View Details â†’</span>
        </div>
      </a>
      {% endfor %}
    </div>
    {% else %}
    <div class="no-sessions-msg">
      ğŸ“­ No sessions found yet. Complete your first workout to see your progress here!
    </div>
    {% endif %}

    <div class="row g-4 mt-4">
      <div class="col-12">
        <div class="chart-container">
          <h5 class="chart-title">ğŸ“ˆ Daily Progress (Last 30 Days)</h5>
          <div id="dailyChart" style="height: 360px;"></div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="chart-container">
          <h5 class="chart-title">ğŸ“Š Weekly Average (Last 12 Weeks)</h5>
          <div id="weeklyChart" style="height: 360px;"></div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="chart-container">
          <h5 class="chart-title">ğŸ“† Monthly Overview (Last 12 Months)</h5>
          <div id="monthlyChart" style="height: 360px;"></div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  const PROGRESS_DATA_URL = "{% url 'progress_data' %}";
</script>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="{% static 'tracker/js/show_progress.js' %}"></script>

{% endblock %}

{% block extra_js %}
<script src="{% static 'tracker/js/pages/progress/show_progress.js' %}"></script>
{% endblock %}