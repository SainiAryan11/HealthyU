{% extends "tracker/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'tracker/css/today_session.css' %}">
{% endblock %}

{% block content %}
<div class="container my-4">

  <div class="exercise-container">

    <!-- Header -->
    <div class="exercise-header">
      <div>
        <h2 id="exName">Loading...</h2>
        <p id="exDesc" class="mb-1"></p>
        <div class="small-note" id="phaseText"></div>
      </div>

      <div class="progress-circle">
        <span id="progressText">0%</span>
      </div>
    </div>

    <!-- Steps -->
    <h4 class="mt-4">Steps to Perform</h4>
    <div class="steps-grid" id="stepsGrid"></div>

    <!-- Buttons -->
    <div class="session-actions">
      <div>
        <button class="btn btn-secondary" id="prevBtn">Previous</button>
      </div>

      <div>
        <button class="btn btn-success" id="doBtn">Do this exercise</button>
      </div>

      <div class="d-flex gap-2 flex-wrap justify-content-end">
        <button class="btn btn-secondary" id="nextBtn">Next</button>
        <button class="btn btn-warning" id="skipBtn">Skip</button>
        <button class="btn btn-danger" id="endBtn">End Session</button>
      </div>
    </div>

  </div>

  <!-- Completion Modal -->
  <div id="phaseModal" class="modal-overlay">
    <div class="modal-box">
      <h3 id="modalTitle">Completed ðŸŽ‰</h3>
      <p id="modalText" class="mb-2">Good job!</p>
      <p class="small-note mb-0" id="modalSubText"></p>

      <div class="modal-actions mt-3">
        <button class="btn btn-secondary" id="modalBackBtn">Back</button>
        <button class="btn btn-danger" id="modalEndBtn">End Session</button>

        <button class="btn btn-success" id="modalNextPhaseBtn">Continue</button>
        <button class="btn btn-primary" id="modalFinishBtn" style="display:none;">Finish Session</button>
      </div>
    </div>
  </div>

</div>

<!-- DATA FROM DJANGO -->
<script>
  const PHYSICAL = JSON.parse('{{ physical_json|escapejs }}');
  const YOGA = JSON.parse('{{ yoga_json|escapejs }}');

  const MEDITATION_RAW = '{{ meditation_json|escapejs }}';
  const MEDITATION = MEDITATION_RAW ? JSON.parse(MEDITATION_RAW) : null;

  const HAS_PHYSICAL = {{ has_physical|yesno:"true,false" }};
  const HAS_YOGA = {{ has_yoga|yesno:"true,false" }};
  const HAS_MEDITATION = {{ has_meditation|yesno:"true,false" }};

  const SESSION_REPORT_URL = "{% url 'session_report' %}";
  const PROFILE_URL = "{% url 'profile' %}";
</script>

<script src="{% static 'tracker/js/today_session.js' %}"></script>
{% endblock %}